(()=>{"use strict";var t={n:e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},d:(e,n)=>{for(var a in n)t.o(n,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:n[a]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const e=window.jQuery;var n=t.n(e);const a=window.wp.apiFetch;var l=t.n(a);const c=window.wp.date;function i(t,e,n){let{$dates:a,$timetable:l,$prev:i,$next:_,buttonLabel:s,reserveUrl:r}=t;!function(t,e,n){const a=e[n];t.val(a.date)}(a,e,n),function(t,e,n,a,l){const i=a[l],_=i.title,s=(0,c.dateI18n)("Y年n月j日（D）",i.date),r=i.timetable.map((t=>{const a=(()=>{switch(t.capacity){case"○":default:return'<img src="/wp-content/themes/fabric/images/icon_possible.png" alt="○" />';case"△":return'<img src="/wp-content/themes/fabric/images/icon_few.png" alt="△" />';case"×":return'<img src="/wp-content/themes/fabric/images/icon_vacant.png" alt="×" />'}})();return`<div class="qms4__block__timetable__timetable-body-row">\n\t\t\t<div class="qms4__block__timetable__timetable-body-time">${t.label}</div>\n\t\t\t<div class="qms4__block__timetable__timetable-body-capacity">${a}</div>\n\t\t\t<div class="qms4__block__timetable__timetable-body-entry">\n\t\t\t\t<p class="qms4__block__timetable__timetable-body-comment">\n\t\t\t\t\t${t.comment}\n\t\t\t\t</p>\n\t\t\t\t<div class="qms4__block__timetable__timetable-body-button">\n\t\t\t\t\t${"×"!==t.capacity?`<a href="${decodeURI(n+"?event_name="+o(_)+"&event_time="+o(s)+"%20"+o(t.label))}">${e}</a>`:""}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>`}));t.html(r)}(l,s,r,e,n),function(t,e,n){if(0===n)t.hide();else{const a=e[n-1];t.html((0,c.dateI18n)("n月j日",a.date)).show()}}(i,e,n),function(t,e,n){if(n===e.length-1)t.hide();else{const a=e[n+1];t.html((0,c.dateI18n)("n月j日",a.date)).show()}}(_,e,n)}function o(t){const e=new RegExp("</?("+["br","p","b","em","div","pre","span","small","strong"].join("|")+")[^>]*>","g");return t.replace(e,"").replace(/&/g,"＆").replace(/#/g,"＃").replace(/'/g,"&#096;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}{const _=Object.create(null);function s(t){return _[t]?_[t]:_[t]=l()({path:t}).then((t=>t.qms4__schedules))}n()(".js__qms4__block__timetable").each((async function(){const t=n()(this),e=t.find(".js__qms4__block__timetable__dates select"),a=t.find(".js__qms4__block__timetable__timetable-body"),l=t.find(".js__qms4__block__timetable__button-prev"),o=t.find(".js__qms4__block__timetable__button-next"),_=t.data("current"),r=t.data("endpoint"),d=t.data("button-label"),b=t.data("reserve-url"),m={$dates:e,$timetable:a,$prev:l,$next:o,buttonLabel:d,reserveUrl:b},u=await s(`${r}?enable_schedule_only=1`).then((t=>t.sort(((t,e)=>t.date<e.date?-1:1))));if(console.info({schedules:u}),0===u.length)return;let p=0;_&&(p=u.findIndex((t=>t.date===_)),p=p<0?0:p),e.html(function(t){return t.map((t=>`<option value="${t.date}">${(0,c.dateI18n)("n月j日（D）",t.date)}</option>`))}(u).join("")),i(m,u,p),e.on("change",(function(t){const n=e.val(),a=u.findIndex((t=>t.date===n));a>=0&&(p=a,i(m,u,p))})),l.on("click",(function(t){t.preventDefault(),p-=1,i(m,u,p)})),o.on("click",(function(t){t.preventDefault(),p+=1,i(m,u,p)}))}))}})();